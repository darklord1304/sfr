#include <fstream>
#include <iostream>
#include <string>
#include <cstring>

class record {
public:
    char name[20];
    char usn[20];
};

std::fstream file[8];
int no;
char fname[8][8] = {"1.txt", "2.txt", "3.txt", "4.txt", "5.txt", "6.txt", "7.txt", "8.txt"};

void merge_file(char* file1, char* file2, char* filename) {
    record recd[20];
    int i, k;
    k = 0;
    std::fstream f1, f2;
    f1.open(file1, std::ios::in);
    f2.open(file2, std::ios::in);
    while (!f1.eof()) {
        f1.getline(recd[k].name, 20, '|');
        f1.getline(recd[k++].usn, 20, '\n');
    }
    while (!f2.eof()) {
        f2.getline(recd[k].name, 20, '|');
        f2.getline(recd[k++].usn, 20, '\n');
    }
    int t, y;
    record temp;
    for (t = 0; t < k - 2; t++)
        for (y = 0; y < k - t - 2; y++)
            if (std::strcmp(recd[y].name, recd[y + 1].name) > 0) {
                temp = recd[y];
                recd[y] = recd[y + 1];
                recd[y + 1] = temp;
            }
    std::fstream temp1;
    temp1.open(filename, std::ios::out);
    for (t = 1; t < k - 1; t++)
        temp1 << recd[t].name << "|" << recd[t].usn << "\n";
    f1.close();
    f2.close();
    temp1.close();
    return;
}

void kwaymerge() {
    int i, k;
    k = 0;
    char filename[7][20] = {"11.txt", "22.txt", "33.txt", "44.txt", "111.txt", "222.txt", "1111.txt"};
    for (i = 0; i < 8; i += 2) {
        merge_file(fname[i], fname[i + 1], filename[k++]);
    }
    k = 4;
    for (i = 0; i < 4; i += 2) {
        merge_file(filename[i], filename[i + 1], filename[k++]);
    }
    merge_file(filename[4], filename[5], filename[6]);
    return;
}

int main() {
    int i;
    std::cout << "Enter the number of records: ";
    std::cin >> no;
    std::cout << "\nEnter the details:\n";
    for (i = 0; i < 8; i++)
        file[i].open(fname[i], std::ios::out);
    record rec;
    for (i = 0; i < no; i++) {
        std::cout << "Name: ";
        std::cin >> rec.name;
        std::cout << "USN: ";
        std::cin >> rec.usn;
        file[i % 8] << rec.name << "|" << rec.usn << "\n";
    }
    for (i = 0; i < 8; i++)
        file[i].close();
    kwaymerge();
    std::fstream result;
    result.open("1111.txt", std::ios::in);
    std::cout << "\nSorted records:\n";
    char name[20], usn[20];
    for (i = 0; i < no; i++) {
        result.getline(name, 20, '|');
        result.getline(usn, 20, '\n');
        std::cout << "\nName: " << name << "\nUSN: " << usn << "\n";
    }
    result.close();

    std::cin.ignore();
    std::cin.get();
    return 0;
}
